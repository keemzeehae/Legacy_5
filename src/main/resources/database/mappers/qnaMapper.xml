<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.keem.s1.board.qna.QnaDAO">

	<insert id="reply" parameterType="QnaDTO">
		INSERT INTO QNA 
		VALUES(QNA_SEQ.NEXTVAL,#{title},#{contents},#{writer},SYSDATE,0,#{ref},#{step},#{depth})
	</insert>

	<update id="stepUpdate" parameterType="QnaDTO">
	UPDATE QNA SET STEP=STEP+1
	WHERE REF=#{ref} AND STEP>#{step}	
	</update>

	<select id="total" resultType="Long" parameterType="Pager">
 		SELECT COUNT(num) FROM QNA
 		WHERE NUM>0
 		AND
 			<choose>
 				<when test="kind=='writer'">WRITER</when>
 				<when test="kind=='title'">TITLE</when>
 				<otherwise>
 					CONTENTS
 				</otherwise>
 			</choose>
 			LIKE '%'||#{search}||'%'
 	</select>
 
 	<update id="update" parameterType="QnaDTO">
 		UPDATE QNA SET TITLE=#{title},CONTENTS=#{contents},WRITER=#{writer}
 		WHERE NUM=#{num}
 	</update>
 	
 	<select id="list" parameterType="Pager" resultType="QnaDTO" >
 		SELECT * FROM
 		(SELECT ROWNUM R, Q.* FROM
 		(SELECT * FROM QNA WHERE
 			NUM>0
 			AND 
 			<choose>
 				<when test="kind=='writer'">WRITER</when>
 				<when test="kind=='title'">TITLE</when>
 				<otherwise>
 					CONTENTS
 				</otherwise>
 			</choose>
 			LIKE '%'||#{search}||'%'
 			ORDER BY REF DESC, STEP ASC) Q)
 		WHERE R BETWEEN #{startRow} AND #{lastRow}
 			
 	</select>
 	
 	<insert id="add" parameterType="QnaDTO">
 		INSERT INTO QNA
		VALUES(QNA_SEQ.NEXTVAL,#{title},#{contents},#{writer},SYSDATE,0,qna_seq.currval,0,0)
 	</insert>
 	
 	<select id="detail" parameterType="QnaDTO" resultType="QnaDTO">
 		SELECT * FROM QNA WHERE NUM=#{num}
 	</select>
 	
 	<delete id="delete" parameterType="QnaDTO">
 		DELETE QNA WHERE NUM=#{num}
 	</delete>
</mapper>
